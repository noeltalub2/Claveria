<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
    <link rel="manifest" href="/icons/site.webmanifest">
    <link rel="mask-icon" href="/icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="theme-color" content="#ffffff">

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com" rel="preconnect">
    <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&family=Inter:wght@100;200;300;400;500;600;700;800;900&family=Nunito:ital,wght@0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
        rel="stylesheet">


    <!-- Vendor CSS Files -->
    <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
    <link href="assets/vendor/aos/aos.css" rel="stylesheet">
    <link href="assets/vendor/glightbox/css/glightbox.min.css" rel="stylesheet">
    <link href="assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet">

    <!-- Main CSS File -->
    <link href="assets/css/main.css" rel="stylesheet">

    <title>Claveria Bus Booking</title>
    <style>
        .submit-btn {
            width: 150px;
            padding: 10px;
            background-color: #388da8;
            color: white;
            border: none;
            cursor: pointer;
            font-size: 1.2rem;
            border-radius: .75rem;
        }

        .submit-btn:hover {
            background-color: #3f9fbd;
        }


        .book-btn {
            width: 100px;
            padding: 6px;
            background-color: #388da8;
            color: white;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            border-radius: .75rem;
        }

        .book-btn:hover {
            background-color: #3f9fbd;
        }

        .highlight {
            color: #3f9fbd;
        }

        .book-btn-1 {

            padding: 8px;
            background-color: #388da8;
            color: white;
            border: none;
            cursor: pointer;
            font-size: 14px;
            border-radius: .8rem;
        }

        .book-btn-1:hover {
            color: white;
            background-color: #3f9fbd;
        }

        .book-btn-danger {

            padding: 8px;
            background-color: #dc3545;
            color: white;
            border: none;
            cursor: pointer;
            font-size: 14px;
            border-radius: .8rem;
        }

        .book-btn-danger:hover {
            color: white;
            background-color: #dc3545;
        }

        /* Existing styles */
        .seat {
            position: relative;
            width: 60px;
            height: 60px;
            display: inline-block;
            text-align: center;
            vertical-align: middle;
        }

        .seat img {
            width: 100%;
            height: auto;
            vertical-align: middle;
        }

        .seat span {
            position: absolute;
            width: 100%;
            top: 50%;
            left: 0;
            transform: translateY(-50%);
            font-size: 12px;
            color: black;
            pointer-events: none;
        }

        /* New styles for hover and selected states */
        .seat.available:hover {
            background-color: #3f9fbd;
            /* Light green background for hover on available seats */
            cursor: pointer;
            border-radius: 5px;
        }

        .seat.selected {
            background-color: #3f9fbd;
            border-radius: 5px;
            /* Blue background for selected seats */
        }

        .seat.unavailable,
        .seat.booked {
            background-color: #e74c3c;
            /* Red background for unavailable and booked seats */
            cursor: not-allowed;
            border-radius: 5px;
        }
    </style>
</head>

<body class="index-page">

    <header id="header" class="header d-flex align-items-center ">
        <div class="container-fluid container-xl position-relative d-flex align-items-center">

            <a href="/" class="logo d-flex align-items-center me-auto">
                <img src="/images/logo.png" alt="">
                <h1 class="sitename">Claveria Tours</h1>
            </a>

            <nav id="navmenu" class="navmenu">
                <ul>
                    <li><a href="/#" class="">Home</a></li>
                    <li><a href="/#about">About</a></li>
                    <li><a href="/#contact">Contact Us</a></li>

                    <%if (user.role==='guess' ) {%>
                </ul>
                <i class="mobile-nav-toggle d-xl-none bi bi-list"></i>
            </nav>

            <a class="btn-getstarted" href="/login">Login</a>
            <%} else {%>


                <li><a href="/account">My Account</a></li>
                </ul>
                <i class="mobile-nav-toggle d-xl-none bi bi-list"></i>
                </nav>

                <a class="btn-getstarted" href="/logout">Logout</a>
                <%}%>


        </div>
    </header>

    <main class="main">
        <div class="container-lg">
            <div class="row">
                <div class="col-lg-6">
                    <div class="p-4 rounded-4 shadow-sm mb-3">
                        <div class="row  align-items-center">
                            <div class="col-auto">
                                <img src="/images/profile/default.jpg" alt=""
                                    class="rounded-circle border border-2 img-fluid" width="70" height="70">
                            </div>
                            <div class="col-auto">
                                <h4 class="mb-0 fw-bold">
                                    <%=user.fullname%>
                                </h4>
                                <p class="mb-0 text-muted"><svg xmlns="http://www.w3.org/2000/svg" width="16"
                                        height="16" fill="currentColor" class="bi bi-envelope" viewBox="0 0 16 16">
                                        <path
                                            d="M0 4a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2zm2-1a1 1 0 0 0-1 1v.217l7 4.2 7-4.2V4a1 1 0 0 0-1-1zm13 2.383-4.708 2.825L15 11.105zm-.034 6.876-5.64-3.471L8 9.583l-1.326-.795-5.64 3.47A1 1 0 0 0 2 13h12a1 1 0 0 0 .966-.741M1 11.105l4.708-2.897L1 5.383z" />
                                    </svg>
                                    <%=user.email%>
                                </p>

                                <p class="mb-0 text-muted"><svg xmlns="http://www.w3.org/2000/svg" width="16"
                                        height="16" fill="currentColor" class="bi bi-telephone" viewBox="0 0 16 16">
                                        <path
                                            d="M3.654 1.328a.678.678 0 0 0-1.015-.063L1.605 2.3c-.483.484-.661 1.169-.45 1.77a17.6 17.6 0 0 0 4.168 6.608 17.6 17.6 0 0 0 6.608 4.168c.601.211 1.286.033 1.77-.45l1.034-1.034a.678.678 0 0 0-.063-1.015l-2.307-1.794a.68.68 0 0 0-.58-.122l-2.19.547a1.75 1.75 0 0 1-1.657-.459L5.482 8.062a1.75 1.75 0 0 1-.46-1.657l.548-2.19a.68.68 0 0 0-.122-.58zM1.884.511a1.745 1.745 0 0 1 2.612.163L6.29 2.98c.329.423.445.974.315 1.494l-.547 2.19a.68.68 0 0 0 .178.643l2.457 2.457a.68.68 0 0 0 .644.178l2.189-.547a1.75 1.75 0 0 1 1.494.315l2.306 1.794c.829.645.905 1.87.163 2.611l-1.034 1.034c-.74.74-1.846 1.065-2.877.702a18.6 18.6 0 0 1-7.01-4.42 18.6 18.6 0 0 1-4.42-7.009c-.362-1.03-.037-2.137.703-2.877z" />
                                    </svg>
                                    <%=user.contact%>
                                </p>
                            </div>
                            <div class="col">
                                <div class="text-center">
                                    <button type="button" class="btn btn-outline-primary" data-bs-toggle="modal"
                                        data-bs-target="#exampleModal">
                                        Edit Profile
                                    </button>
                                </div>


                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="p-4 shadow-sm rounded-4">
                <h4 class="fw-bold" style="color: #388da8;">Active Booking</h4>
                <div class="table-responsive-md">
                    <table id="userTable" class="table table-hover " style="width:100%">
                        <thead class="table-dark">
                            <tr>
                                <th scope="col">#</th>
                                <th scope="col">ROUTE</th>
                                <th scope="col">DEPARTURE</th>
                                <th scope="col">SEAT NUMBER</th>
                                <th scope="col">DROP OFF</th>
                                <th scope="col">TOTAL AMOUNT</th>
                                <th scope="col">STATUS</th>
                                <th scope="col">BOOKING EXPIRATION</th>
                                <th scope="col">ACTION</th>
                            </tr>
                        </thead>
                        <tbody>
                            <% active_bookings.forEach((booking, index)=> { %>
                                <tr>
                                    <th scope="row">
                                        <%= index + 1 %>
                                    </th>
                                    <td>

                                        <%= booking.origin %> - <%= booking.destination %>

                                    </td>
                                    <td>

                                        <%= new Intl.DateTimeFormat('en-US', {month: 'short' , day: '2-digit' ,
                                            year: 'numeric' }).format(booking.departure_date) %> <br>
                                            <%=booking.departure_time%>

                                    </td>
                                    <td class="text-center">
                                        <%= booking.seat_numbers %>
                                    </td>
                                    <td>
                                        <%= booking.drop_off %>
                                    </td>
                                    <td>
                                        <%= booking.fare_paid %>
                                    </td>
                                    <td>
                                        <%= booking.status %>
                                    </td>
                                    <td>
                                        <%= new Intl.DateTimeFormat('en-US', {month: 'short' , day: '2-digit' ,
                                            year: 'numeric' }).format(booking.booking_expiration) %>
                                    </td>
                                    <td class="text-center">
                                        <%if (booking.status === 'Paid') { %>
                                            <a class="btn book-btn-1 mb-1"
                                            href="/getBooking/<%= booking.booking_id %>">View</a>
                                        <%} else {%>
                                            <a class="btn book-btn-1 mb-1"
                                            href="/getBooking/<%= booking.booking_id %>">View</a>
                                        <button class="btn book-btn-danger mb-1"
                                            onclick="cancelReservation('<%= booking.booking_id %>')">Cancel</button>
                                        <%}%>
                                     
                                    </td>
                                </tr>
                                <% }) %>

                        </tbody>
                    </table>
                </div>

            </div>
            <div class="p-4 shadow-sm rounded-4">
                <h4 class="fw-bold" style="color: #388da8;">History Booking</h4>
                <div class="table-responsive-md">
                    <table id="historyTable" class="table table-hover " style="width:100%">
                        <thead class="table-dark">
                            <tr>
                                <th scope="col">#</th>
                                <th scope="col">ROUTE</th>
                                <th scope="col">DEPARTURE</th>
                                <th scope="col">SEAT NUMBER</th>
                                <th scope="col">DROP OFF</th>
                                <th scope="col">TOTAL AMOUNT</th>
                                <th scope="col">STATUS</th>
                                <th scope="col">BOOKING EXPIRATION</th>

                            </tr>
                        </thead>
                        <tbody>
                            <% history_bookings.forEach((booking, index)=> { %>
                                <tr>
                                    <th scope="row">
                                        <%= index + 1 %>
                                    </th>
                                    <td>

                                        <%= booking.origin %> - <%= booking.destination %>

                                    </td>
                                    <td>

                                        <%= new Intl.DateTimeFormat('en-US', {month: 'short' , day: '2-digit' ,
                                            year: 'numeric' }).format(booking.departure_date) %> <br>
                                            <%=booking.departure_time%>

                                    </td>
                                    <td class="text-center">
                                        <%= booking.seat_numbers %>
                                    </td>
                                    <td>
                                        <%= booking.drop_off %>
                                    </td>
                                    <td>
                                        <%= booking.fare_paid %>
                                    </td>
                                    <td>
                                        <%= booking.status %>
                                    </td>
                                    <td>
                                        <%= new Intl.DateTimeFormat('en-US', {month: 'short' , day: '2-digit' ,
                                            year: 'numeric' }).format(booking.booking_expiration) %>
                                    </td>


                                </tr>
                                <% }) %>

                        </tbody>
                    </table>
                </div>

            </div>
            <!-- Modal -->
            <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel"
                aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h1 class="modal-title fs-5" id="exampleModalLabel">Edit Profile</h1>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <form action="/account/edit" method="post">
                            <div class="modal-body">
                                <div class="row">
                                    <div class="col-lg-6">
                                        <div class=" mb-3">
                                            <input class="form-control fc-custom" name="fullname" type="text"
                                                placeholder="Full name" aria-label="fullname Input" required
                                                id="fullname" value="<%=user.fullname%>">
                                        </div>
                                    </div>
                                    <div class="col-lg-6">
                                        <div class="mb-3">
                                            <input class="form-control fc-custom" name="email" type="email"
                                                placeholder="Email" aria-label="email Input" required
                                                value="<%=user.email%>">
                                        </div>
                                    </div>
                                    <div class="col-lg-6">
                                        <div class=" mb-3">
                                            <input class="form-control fc-custom" name="contact" type="text"
                                                placeholder="Contact" aria-label="contact Input" required id="contact"
                                                value="<%=user.contact%>">
                                        </div>
                                    </div>
                                    <div class="col-lg-6">
                                        <div class="mb-3">
                                            <input class="form-control fc-custom" name="address" type="text"
                                                placeholder="Address" aria-label="address Input" required
                                                value="<%=user.address%>">
                                        </div>
                                    </div>
                                    <div class="col-lg-12">
                                        <div class="mb-3">
                                            <input class="form-control fc-custom" name="username" type="text"
                                                placeholder="Username" aria-label="username Input" required
                                                value="<%=user.username%>">
                                        </div>
                                    </div>
                                    <div class="col-lg-12">
                                        <div class="mb-3">
                                            <input class="form-control fc-custom" name="password" type="password"
                                                placeholder="Password (optional)" aria-label="password Input"
                                                pattern="(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{8,}">
                                            <div class="text-start mt-1" style="font-size: 0.75rem;">
                                                Must contain at least one number and one uppercase and lowercase
                                                letter,
                                                and at
                                                least 8 or more characters
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                <button type="submit" class="btn btn-primary">Save changes</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
            <!-- Scroll Top -->
            <a href="#" id="scroll-top" class="scroll-top d-flex align-items-center justify-content-center"><i
                    class="bi bi-arrow-up-short"></i></a>

            <!-- Preloader -->
            <div id="preloader"></div>

            <!-- Vendor JS Files -->
            <script src="/assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
            <script src="/assets/vendor/aos/aos.js"></script>
            <script src="/assets/vendor/glightbox/js/glightbox.min.js"></script>
            <script src="/assets/vendor/swiper/swiper-bundle.min.js"></script>

            <!-- Main JS File -->
            <script src="/assets/js/main.js"></script>

            <script src="/vendor/datatables/jquery.js"></script>
            <script src="/vendor/datatables/datatables.js"></script>
            <script src="/vendor/datatables/datatables.bootstrap.js"></script>
            <script>
                new DataTable('#userTable', {
                    pageLength: 5,
                    lengthMenu: [[5, 10, 15, -1], [5, 10, 15, "All"]] // Sets the options for "Show X entries" dropdown
                });
                new DataTable('#historyTable', {
                    pageLength: 5,
                    lengthMenu: [[5, 10, 15, -1], [5, 10, 15, "All"]] // Sets the options for "Show X entries" dropdown
                });
            </script>
            <%-include ("../Home/message.ejs")%>

                <script>
                    function cancelReservation(id) {
                        Swal.fire({
                            title: "Cancel Reservation",
                            text: `Are you sure you want to cancel this reservation? This action cannot be undone.`,
                            icon: "warning",
                            showCancelButton: true,
                            confirmButtonText: "Confirm", // Set the text for the confirmation button
                            cancelButtonText: "Cancel",  // Set the text for the cancel button
                        }).then((result) => {
                            if (result.isConfirmed) {
                                fetch("/cancel-booking", {
                                    method: "POST",
                                    body: JSON.stringify({ id }),
                                    headers: { "Content-Type": "application/json" },
                                })
                                    .then((res) => res.json())
                                    .then((response) => {

                                        if (response.success) {
                                            Swal.fire(
                                                'Success!',
                                                `${response.message}`,
                                                'success'
                                            ).then(function () {
                                                window.location.href = '/account';
                                            });
                                        }
                                        else {
                                            Swal.fire(
                                                'Error',
                                                `${response.message}`,
                                                'error'
                                            ).then(function () {
                                                window.location.href = '/account';
                                            });
                                        }
                                    });
                            } else if (result.isDismissed) {
                                // User clicked the "Cancel" button or outside the dialog
                                // You can add code for what should happen when the cancel button is clicked or the dialog is dismissed
                            }
                        });
                    }


                </script>
    </main>


</body>

</html>